# < Brunch Networking >

<br>

<b> Original Repository = > [Brunch_Networking Repository](https://github.com/bill7845/project_brunchNetworking_streamlit) </b>

<br>

## <b> 브런치 작가를 위한 Text 분류모델과 추천시스템 </b>



글쓰기 플랫폼 "Brunch"를 아시나요?
브런치는 "누구나 작가가 될 수 있다"를 모토로 하는 콘텐츠 퍼블리싱 플랫폼입니다.브런치가 주목받는 이유 중 하나는 전문 작가가 아닌 일반인들도 자신들의 글을 연재할 수 있는 서비스를 제공해준다는것인데요, 이러한 서비스를 바탕으로 현재 브런치에는 수 많은 일반인 작가들이 다양한 글을 게시하고 독자들을 끌어들이고 있습니다. <br><br>
`"Brunch Networking"` 프로젝트의 목적은 "머신러닝"을 활용하여 작가들에게 편리함을 제공하는것 입니다. "브런치 네트워킹"은 데이터 수집부터 전처리, 모델링, API를 활용한 실제 서비스까지 머신러닝 프로젝트의 전 과정을 다루고 있습니다.

<br>

## < 전체 흐름도 및 아키텍처 >

<br>

프로젝트의 전체적인 흐름입니다. BeautifulSoup과 Selenium을 사용하여 브런치의 게시글 20만개를 수집하였고, 한글 형태소 분석기인 Konlpy를 활용하여 수집된 텍스트 데이터를 전처리하였습니다. 이후에 여러가지 분류모델을 실험하고 가장 적합한 모델을 최종 선택하여 Streamlit을 활용해 APP형태로 구현하였습니다.

![프로젝트 흐름도](https://user-images.githubusercontent.com/35517797/83950017-8cc1e480-a862-11ea-8d78-58c0a0671794.PNG)

<br>>

프로젝트 아키텍처입니다. AWS EC2를 활용해 Streamlit 어플리케이션을 배포하였습니다. 수집 된 데이터는 GCP의 Bigquery를 통해 저장하였으며 모델, json, pickle등의 File 산출물은 S3를 통해 저장하고 로딩하였습니다. 어플리케이션을 실행함에 따라 생성되는 User Activity 데이터는 AWS의 RDS를 통해 저장,관리하였습니다.

<br>

## < 모델 학습 및 선택 >

<br>

모델 학습 과정과 최종 모델 선택에 관한 부분입니다. "브런치 네트워킹"의 분류모델이 풀어야할 과제는 18개의 클래스를 가지는 텍스트 다중분류 문제입니다. 가장 중요하고 우선시되어야 하는것은 역시 수집된 텍스트 데이터에 대한 전처리입니다. 다음의 과정으로 진행하였습니다.

  1. <b> url, 특수 문자, 마침표를 제거한다. </b>
  2. <b> 영어,한글을 제외한 언어를 제거한다. </b>
  3. <b> 한글 불용어를 제거한다. </b>
  4. <b> 형태소 분석 </b>
  
![전처리 전후](https://user-images.githubusercontent.com/35517797/83950031-9d725a80-a862-11ea-9620-17c4007d8de5.PNG)

형태소 분석의 경우에 Konlpy의 mecab,okt 라이브러리를 사용하여 각각 명사추출,품사추출 등 여러가지 경우를 실험하였고 최종적으로 길이가 2이상인 명사추출법을 적용하였습니다. 다음으로는 데이터를 머신러닝 모델이 이해할 수 있도록 벡터화 과정을 진행하였습니다.

  1. <b> Bag-of-words </b>
  2. <b> Word2Vec </b>

BOW와 Word2Vec 2가지의 방법을 실험하였습니다. 먼저 BOW 방식은 문서가 가지는 모든 단어(Words)를 문맥이나 순서를 무시하고 단어에 빈도 값을 부여하는 방식입니다. 즉, 전체 문서에서 각 단어들이 등장하는 빈도수를 기반으로 피처 벡터화를 수행하는 것입니다. BOW 방식은 "문맥의미 반영부족"과 "희소 행렬"이라는 문제점을 발생시킵니다. 이러한 문제점을 보완하기 위해 TF-IDF 방식을 적용하였습니다. TF-IDF 방식 또한 BOW 방식에 속하지만 개별 문서에서 자주 나타나는 단어에 높은 "가중치"를 주되, 모든 문서에서 전반적으로 나타나는 단어에 대해서는 페널티를 주는 방식을 통해 BOW가 가진 문제점을 보완한 방식입니다.

<br>

Word2Vec의 경우 BOW처럼 n차원의 희소 벡터를 만드는것이 아닌 밀집된 벡터를 통해 좀 더 압축된(Dense) 데이터로 변환을 가능케 합니다. 따라서 Word2Vec을 사용할 경우에는 "차원의 저주"와 같이 희소행렬 방식에서 자주 발생되는 문제를 피할수 있고 단어간의 관계(ex. 엄마+아빠=부모님)와 단어간 유사도를 구할수 있는 장점이 있습니다.

<br>

전처리와 벡터화 과정을 거친 후, 실제 텍스트 분류모델에 적용하였습니다. 나이브 베이즈, 로지스틱 회귀, k-NN, 랜덤포레스트, SVM, LightGBM 등 다양한 머신러닝 모델을 통해 예측 정확도를 테스트해보았습니다. 평가지표는 정확도, F1-Score와 top2 error를 기준으로 하였습니다. top2 error는 예측한 최상위 2개 범주 가운데 정답이 없는 경우의 오류율을 나타냅니다. 기존 브런치 게시글들이 단 하나의 카테고리만 가지는것이 아니라 동시에 여러개의 카테고리를 중복해서 가질수 있다는점 때문에 topN error를 평가지표 중 하나로 사용하였습니다. 

![모델지표](https://user-images.githubusercontent.com/35517797/84161304-19aaaf00-aaaa-11ea-8473-84bac8e31d91.PNG)

평가지표와 예측속도 등 여러 요건을 고려하여 Logistic Regression 모델을 최종적으로 선택하였습니다. 이후에 좀 더 복잡한 머신러닝 모델을 적용하거나 딥러닝 모델로 업데이트한다는 가정하에 사용자 입력text, 분류 성공여부, 실패 시 사용자 피드벡 등의 정보를 DB에 저장하는 과정 또한 포함하였습니다.

![classification report](https://user-images.githubusercontent.com/35517797/84173093-c17aa980-aab7-11ea-9918-3bf7f715420c.PNG)

최종 모델인 Logistic Regressin의 Classification Report를 살펴보면, "감성_에세이","멘탈관리_심리탐구","문화_예술","인문학_철학" (카테고리 Number 9,3,4,5) 의 카테고리에서 예측성능이 크게 저하되는것을 확인할 수 있습니다. 해당 카테고리의 게시글들을 실제로 살펴보니 인간의 눈으로도 명확히 구분하기 어려운 주제들이기도 하고 중복된 요소들이 많이 존재한다는점을 확인하였습니다. 이 문제에 대한 개선은 조금 더 복잡한 머신러닝 모델 혹은 딥러닝 모델을 사용하거나 사용자로부터의 피드벡을 통해 개선할 것입니다. 로지스틱 회귀 모델의 Confusion Matrix 또한 마찬가지로 카테고리 Number 9,3,4,5에서 오답률이 두드러지는것을 확인할 수 있습니다.

![confusion matrix](https://user-images.githubusercontent.com/35517797/84172557-1f5ac180-aab7-11ea-886f-e592bb565058.PNG)

<br>

> 현재 브런치의 카테고리는 총 24개입니다. 이 중에서 디자인, 그림웹툰 등 텍스트 보다는 이미지 위주의 글이 대다수인 6개의 카테고리를 제외한 18개의 카테고리만을 사용하였습니다.

<br>

## < 모델 배포, Web Application >

<br>

모델을 실제로 배포하고 적용하기위해 python의 web application 툴인 streamlit을 사용하였습니다. streamlit은 웹개발 지식이 없어도 쉽게 사용이 가능하고 간결하고 명확한 방식 덕분에 일정 수준의 결과를 위해 투자되는 시간을 절약할 수 있습니다. 

![모델배포](https://user-images.githubusercontent.com/35517797/83950051-cd216280-a862-11ea-9155-94914b42e0e7.PNG)

<br>

## < 추천 시스템 >

<br> 

"브런치 네트워킹"에 적용한 추천시스템에 관련된 부분입니다. 추천 시스템은 크게 2가지로 나누어 집니다.

  1. 콘텐츠 기반 필터링(Content based filtering)
  2. 협업 필터링(Collaborative Filtering)
  
협업 필터링 방식의 경우 사용자가 글에 매긴 평점 정보나 구독 이력과 같은 사용자 행동 양식(User Behavior)을 기반으로 합니다. 이런 사용자 행동 양식 데이터는 따로 수집이 어렵기 때문에 "브런치 네트워킹"의 추천 시스템은 콘텐츠 기반 필터링 방식을 사용하였습니다. <br>

콘텐츠 기반 필터링 방식은 사용자가 특정한 아이템을 매우 선호하는 경우, 그 아이템과 비슷한 콘텐츠를 가진 다른 아이템을 추천하는 방식입니다. 
본 프로젝트는 브런치의 "작가"를 위한 서비스이므로 사용자를 작가로 한정하고, 작가가 게시하고자 하는 글을 기반으로 콘텐츠 기반 필터링 추천을 진행합니다. 

  1. <b> 키워드 기반 추천 </b> 
  2. <b> 문서 유사도 기반 추천 </b>
  
키워드 기반 방식과 문서 기반 방식 모두 입력 벡터와 기존 게시글,키워드간 벡터의 유사도 비교를 통해 이루어 집니다. <br>
키워드 기반 추천은 사용자가 자신의 게시글에 대한 키워드를 선택/입력하고 입력받은 키워드 리스트와 기존 브런치 게시글(입력 게시글과 같은 카테고리)의 문서별 키워드 리스트를 CountVectorizer로 피처 벡터화한 행렬 데이터 값을 코사인 유사도로 비교합니다. 그 후, 유사도가 가장 높은순으로 텍스트를 추천합니다. 문서 기반 방식은 사용자의 입력 게시글의 tf-idf벡터와 기존 게시글들의 tf-idf벡터간 유사도를 통해 이루어진다는 차이점만 존재합니다.
 

![추천1](https://user-images.githubusercontent.com/35517797/83950055-d7dbf780-a862-11ea-800d-863ea4a842aa.PNG)

![추천2](https://user-images.githubusercontent.com/35517797/83950058-da3e5180-a862-11ea-98d4-b313b75b770d.PNG)
