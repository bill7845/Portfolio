## 프로젝트명

## 프로젝트 소개
에너지 빅데이터를 활용한 전력수요 예측

<hr></hr>

## 1. 프로젝트 소개 <br>

<br>

**<q> 딥러닝을 활용해 미래의 전력수요량을 예측하기 </q>**

<br>

> 과거의 전력 수요량 데이터와 수요패턴을 알고있다면 미래의 전력 수요량과 패턴을 예측할 수 있습니다. 이러한 <b>예측</b>을 활용한다면 , 수요예측에 의한 안정적 전력수급관리계획의 수립, 전력수요 낭비 예방 등 효율적 에너지 사용에 기여할 수 있습니다

<br>

* 수요예측에 의한 전력수요 낭비 예방
* 안정적 수급관리 계획에 의한 공급예비율 관리

<br>

> 문제는 <b>"예측률"</b>과 <b>"정확도"</b>인데요, IOT(사물인터넷)의 발달은 각 가정별 실시간의 데이터 수집을 가능하게 하였고 더욱더 정교한 수요예측이 가능해졌습니다.
> 기존의 전력수요예측은 통합적,지역적 대상의 예측이였다면, 저희 TEAM_썬더의 예측모델은 이처럼 양질의 다양해진 데이터를 활용하여<b>가정별,시설별 맞춤형 수요예측에 목적을 둔 예측모델입니다.</b>

<br>

* 통합적 수요 예측모델 --> 세대별,가정별,시설별 맞춤형 수요 예측모델

<br>

> 이러한 TEAM_썬더 예측모델을 활용한다면 가정별,시설별 전력수요패턴에 맞추어 Target 캠페인을 진행하는 등 세대별 관리 뿐만 아니라 EMS,BMS등의 시설 에너지 관리의 효율 또한 높힐 수 있을것입니다.


## 2. 모델링

<br>

> *model concept*

TEAM_썬더의 컨셉은 다음과 같습니다.
세대별(가정별,건물별) 전력수요량의 과거 데이터를 통하여 <b>세대별 미래의 전력수요량을 시간단위로 예측하는것입니다</b>

![모델이미지](https://user-images.githubusercontent.com/35517797/69211852-d25ae080-0ba2-11ea-8568-2453d0dd16f0.PNG)

<br>

> *EDA*

<br>

**<q> EDA - 데이터 구조 탐색 및 이해 </q>** <br>

우선, 데이터에 대해 살펴보아야합니다.
데이터는 인천지역 총 1500세대의 과거 전력수요량 데이터로 이루어져있으며 이 중 1300세대의 데이터를 Train 나머지 200세대를 Test 데이터로 사용하였습니다. <br>
Train과 Test의 세대는 서로 중복되지 않는 다른 세대이며, Test세대는 2016년 7월 26일 ~ 2018년 6월 30일의 시간당 전력사용량이고 Train은 2017년 7월 1일 00시 ~ 2018년 6월 30일 24시까지 시간 당 전력사용량입니다.

![데이터셋이해구조](https://user-images.githubusercontent.com/35517797/69213578-d9382200-0ba7-11ea-9ab4-798a7b6efed2.PNG)

쉽게 설명해보자면 위 그림과같이 철수네,영희네집의 전력수요 데이터와 수요패턴을 바탕으로 전혀 다른 세대들의 전력 수요량을 예측해야하는 개념입니다. <br><br>

**<q> EDA - 결측값과 이상치 파악 </q>** <br>

주어진 총 1500세대의 시계열 데이터는 실제 인천지역 특정 세대들의 전력수요 데이터로 결측값,이상구간 등이 ~~거의 대부분~~ 존재합니다.시계열 데이터에 기반한 모델은 결측값과 이상치에 대해 굉장히 민감할수밖에 없습니다. 따라서 이에 대한 정확한 파악과 대체법에 대한 고민이 필요하였고 아래와 같이 이해하고 접근하였습니다.

* 결측값 발생이유 파악
> 1. 전력사용량 측정기 미설치로 인한 경우
> 2. 직전 시간대 전력사용량 과다로 인한 경우(미터링 데이터 수집 시스템의 특징)

![결측치](https://user-images.githubusercontent.com/35517797/69602376-acc64f00-105a-11ea-894d-4b19be9138d5.png)


* 이상치 구간 파악
> Test 200세대 중 23세대의 전력샤용량이 약 2달간 일정하게 유지되는 이상구간을 확인

![이상구간](https://user-images.githubusercontent.com/35517797/69495033-a70b2500-0f05-11ea-9684-138b12dede9c.PNG)


직전 시간대의 과다 전력 사용량으로 인한 결측값의 경우 해당 결측구간을 (직전 결측값/결측구간길이)의 값으로 대체하였습니다. 미터링 시스템 미설치로 인한 결측값의 경우 대부분이 1년이상의 장기적인 결측구간을 보이므로 ARIMA기법을 활용하여 장기적인 결측구간을 대체하려고 시도하였으나 그럴 경우, <b>예측에 의한 예측</b>의 위험성이 존재한다고 판단하여 실행하지 않았고, 최종적으로 결측값과 이상구간이 존재하지 않는 1429세대의 2018년 2월15일~2018년6월30일 구간의 전력수요량 데이터를 모델링에 Input데이터로 사용하였습니다.

<br>

주의해서 살펴보아야할 부분이 있습니다. Input데이터가 1429세대인 점. 즉, Train가 Test세대가 모델 학습에 동시에 포함되어 있는 이유는 이 문제의 경우 Train과 Test의 대상이 서로 전혀 다르기 때문입니다. 일반적인 경우의 모델 학습시에는 전체 데이터에서 일부분을 떼어내어 Train과 Test로 분할하지만 저희 case의 경우에는 서로 중복되지 않는 대상들이므로 다르게 접근할 필요가 있다고 생각했습니다. <br>

총 1500개의 세대가 존재한다는 말은 1500개의 전력 수요패턴이 존재한다는것을 의미합니다. 비슷한 패턴들이 있을수도 있고, 전혀 다른 독특한 패턴들이 존재할수도 있습니다. 이 경우 Train에 속해있는 세대들만 학습에 포함시킬 경우 Test에 속하는 세대들의 패턴을 반영하지 못할 가능성이 존재한다고 판단하였습니다. 따라서 저희는 Test에 속하는 세대들의 "패턴" 또한 모델에 반영할것을 고려해야 했고 Test 데이터의 기간을 일부 분할하여 모델의 오버피팅에 영향을 미치지 않는 범위의 데이터를 모델 학습시에 추가해주었습니다.

<br>

> *Modeling*

저희팀의 경우 시계열 데이터에 대한 기본적인 지식이 부족하고 또, 가장 중요하다고 생각하였기 때문에 ARIMA등의 전통적 시계열 기법부터 머신러닝,딥러닝 등 시계열데이터에 관련된 알고리즘들을 가능한 많이 적용해보기로 하였습니다. 본 글에서는 최종적으로 적용된 RNN(순환신경망)모델을 중심으로 설명하도록 하겠습니다.

<br>

**<q> RNN과 LSTM </q>**

<br>

딥러닝 알고리즘 중 RNN은 메모리를 가진다는 특징이 있습니다. 이 메모리를 이용하여 과거정보의 상태(state)를 바탕으로 다음 정보를 점진적으로 처리할수 있다는 점에서  데이터의 순서가 중요한 시퀀스 데이터(text,timeseries)를 다루기에 최적화되어있는 알고리즘 중 하나입니다.

![RNN기초수정](https://user-images.githubusercontent.com/35517797/69216953-c6761b00-0bb0-11ea-8f3f-c7b0b699f132.PNG)

위 그림과 같이 X(t)시점의 데이터를 처리함에 있어 X(t-1)시점의 상태(state)에 기반하여 처리하게 됩니다. 즉, 시퀀스 데이터 전체를 한꺼번에 처리하는것이 아닌 사람이 문장을 읽는것과 같이 이전에 나온 것을 기억하면서 한눈에 들어오는 만큼씩 처리하는 개념입니다. 그러나 단순 RNN의 경우 긴 시간에 걸친 의존성은 학습할 수 없는 단점(그래디언트 소실문제)을 가지고있습니다. 따라서 저희팀은 "cell state"라는 개념을 통해 정보(state)를 계속해서 유지해주어 RNN의 단점을 보완한 LSTM알고리즘을 적용하였습니다.

<br>

**<q> input shape과 feature </q>**

<br>

이제 결정된 모델에 어떻게 데이터를 Input하였는지와 어떤 feature를 추가하였는가에 대한 설명입니다. LSTM의 Input데이터 형식은 (전체 size,time-step,feature-dim)의 3D 텐서형식으로 이루어져야합니다. 이에따라 Input 1429세대의 전력수요량 데이터를 (전체size,24,6)의 numpy 형식으로 reshape 해준 뒤 모델에 Input하였습니다. feature의 경우에 총 5개의 feature를 추가해주었고 이는 전력수요량과 가장 높은 상관관계를 가지는 "기온"과 모델이 해당 시간대가 밤인지 낮인지의 여부와 계절을 대략적으로 판단할 수 있는 "시간대","일자" 정보등으로 구성하였습니다.

* 시간대별 기온, 일별 평균기온
* 시간대별 습도, 일별 평균습도
* 시간대 ( 0~23)
* 일자 (1~366)

![feature](https://user-images.githubusercontent.com/35517797/69496774-f0b13b00-0f18-11ea-8664-209cfd015892.PNG)

<br>

**<q> Model Architecture </q>**

<br>

모델의 구조는 다음과 같습니다.
*  96개의 셀을 가지는 LSTM레이어 3개층
* Overfiting 방지를 위한 DropOut 레이어
* seq2seq 형태의 Dense 출력층

![모델아키텍쳐1](https://user-images.githubusercontent.com/35517797/69697149-1874ee80-1125-11ea-93cb-bd77c4c79f2f.PNG)
![모델아키텍쳐2](https://user-images.githubusercontent.com/35517797/69697144-16ab2b00-1125-11ea-99e7-d244ef6b02ce.PNG)

모델 학습 및 예측의 결과는 다음과 같습니다.

* Traing and Validation loss, Train,Test RMSE Score
![loss](https://user-images.githubusercontent.com/35517797/69704264-69411300-1136-11ea-9746-0ed562f67a35.png)
![score](https://user-images.githubusercontent.com/35517797/69704260-66deb900-1136-11ea-8ecf-ca238fedcb15.PNG)

* 예측치 & 실제관측치 시각화
![결과1](https://user-images.githubusercontent.com/35517797/69704542-f5ebd100-1136-11ea-8389-c1e78d425040.png)
![결가2](https://user-images.githubusercontent.com/35517797/69704546-f71cfe00-1136-11ea-9491-7867acd2dbc7.png)

*해당 프로젝트에서 활용한 데이터셋은 dacon 개최 전력수요예측 데이터사이언스 대회 데이터임을 밝힙니다.
*https://dacon.io/cpt11 (dacon homepage)

## 3. 마치며 <br>

이번 프로젝트를 진행하면서 아쉬운점은 역시, 블랙박스라고도 불리는 딥러닝 알고리즘에 대한 깊은 이해가 어려웠다는점입니다. 사용한 알고리즘에 대한 깊은 이해가 있었다면 더 다양한 모델을 사양해보고 앙상블을 시도해볼수 있었을텐데 그러지 못했던 부분이 아쉽게 느껴집니다.
그럼에도, 실제 데이터를 전처리,가공하여 딥러닝 알고리즘에 적용해 본 경험과 시계열 데이터 처리에 대한 경험은 가장 큰 소득으로 남을것이라 생각합니다.

감사합니다.
